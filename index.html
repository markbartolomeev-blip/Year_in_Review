<!DOCTYPE html>
<html>
<head>
    <title>Telegram Stats</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f2f5; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #2c3e50; text-align: center; }
        .card { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #f8f9fa; }
        .error { color: red; background: #ffe6e6; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: green; background: #e6ffe6; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —á–∞—Ç–∞ Telegram</h1>
        
        <div class="card">
            <h3>1. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª result.json</h3>
            <input type="file" id="fileInput" accept=".json">
            <button onclick="analyze()" style="padding: 10px 20px; margin-top: 10px;">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div id="error" class="error hidden"></div>
        <div id="success" class="success hidden"></div>
        
        <div id="results"></div>
    </div>

    <script>
    function analyze() {
        const fileInput = document.getElementById('fileInput');
        const errorDiv = document.getElementById('error');
        const successDiv = document.getElementById('success');
        const resultsDiv = document.getElementById('results');
        
        errorDiv.innerHTML = '';
        errorDiv.classList.add('hidden');
        successDiv.classList.add('hidden');
        resultsDiv.innerHTML = '';
        
        if (!fileInput.files[0]) {
            showError('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª result.json');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞:', Object.keys(data));
                if (data.messages) console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π:', data.messages.length);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                if (!data.messages || !Array.isArray(data.messages)) {
                    showError('–í —Ñ–∞–π–ª–µ –Ω–µ—Ç –º–∞—Å—Å–∏–≤–∞ messages. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞: ' + JSON.stringify(Object.keys(data)));
                    return;
                }
                
                const messages = data.messages;
                showSuccess(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π`);
                
                // –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑
                const users = {};
                const days = {};
                const userDays = {};
                
                messages.forEach(msg => {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    let user = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                    if (msg.from) user = msg.from;
                    else if (msg.from_id) user = 'ID:' + msg.from_id;
                    
                    users[user] = (users[user] || 0) + 1;
                    
                    // –î–∞—Ç–∞
                    if (msg.date) {
                        const date = new Date(msg.date);
                        const dayKey = date.toLocaleDateString('ru-RU');
                        days[dayKey] = (days[dayKey] || 0) + 1;
                        
                        // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (!userDays[user]) userDays[user] = {};
                        userDays[user][dayKey] = (userDays[user][dayKey] || 0) + 1;
                    }
                });
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                let html = '<div class="card">';
                html += '<h3>üìà –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>';
                html += `<p><strong>–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π:</strong> ${messages.length}</p>`;
                html += `<p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> ${Object.keys(users).length}</p>`;
                html += '</div>';
                
                // –¢–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                html += '<div class="card"><h3>üë• –¢–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h3><table>';
                html += '<tr><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–°–æ–æ–±—â–µ–Ω–∏–π</th><th>–°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å</th><th>–°–æ–æ–±—â–µ–Ω–∏–π –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å</th></tr>';
                
                const sortedUsers = Object.entries(users).sort((a, b) => b[1] - a[1]);
                sortedUsers.forEach(([user, count]) => {
                    // –ù–∞—Ö–æ–¥–∏–º –ø–∏–∫–æ–≤—ã–π –¥–µ–Ω—å –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    let peakDay = '-';
                    let peakCount = 0;
                    
                    if (userDays[user]) {
                        Object.entries(userDays[user]).forEach(([day, dayCount]) => {
                            if (dayCount > peakCount) {
                                peakCount = dayCount;
                                peakDay = day;
                            }
                        });
                    }
                    
                    html += `<tr>
                        <td>${user}</td>
                        <td>${count}</td>
                        <td>${peakDay}</td>
                        <td>${peakCount || '-'}</td>
                    </tr>`;
                });
                
                html += '</table></div>';
                
                // –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏
                html += '<div class="card"><h3>üìÖ –°–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏</h3><table>';
                html += '<tr><th>–î–µ–Ω—å</th><th>–°–æ–æ–±—â–µ–Ω–∏–π</th></tr>';
                
                const sortedDays = Object.entries(days).sort((a, b) => b[1] - a[1]).slice(0, 10);
                sortedDays.forEach(([day, count]) => {
                    html += `<tr><td>${day}</td><td>${count}</td></tr>`;
                });
                
                html += '</table></div>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞: ' + error.message + '<br>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.');
            }
        };
        
        reader.onerror = function() {
            showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
        };
        
        reader.readAsText(fileInput.files[0]);
    }
    
    function showError(message) {
        const errorDiv = document.getElementById('error');
        errorDiv.innerHTML = '‚ùå ' + message;
        errorDiv.classList.remove('hidden');
    }
    
    function showSuccess(message) {
        const successDiv = document.getElementById('success');
        successDiv.innerHTML = '‚úÖ ' + message;
        successDiv.classList.remove('hidden');
    }
    
    // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
    document.getElementById('fileInput').addEventListener('change', analyze);
    </script>
</body>
</html>
